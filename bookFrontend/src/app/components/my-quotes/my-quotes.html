<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="m-0">Mina citat</h2>
    <span class="text-muted">Hantera dina favoritcitat</span>
  </div>

  <!-- Lägg till nytt citat -->
  <div class="card mb-4 p-3">
    <form class="row g-3" (ngSubmit)="add()">
      <div class="col-12 col-md-8">
        <label class="form-label">Citat</label>
        <textarea
          class="form-control"
          rows="3"
          [(ngModel)]="newQuote.text"
          name="newText"
          placeholder="&quot;quote &quot;"
        ></textarea>
      </div>

      <div class="col-12 col-md-3">
        <label class="form-label">Författare</label>
        <input
          class="form-control"
          type="text"
          [(ngModel)]="newQuote.author"
          name="newAuthor"
          placeholder="Författarens namn"
        />
      </div>

      <div class="col-12 col-md-1 d-flex align-items-end">
        <button class="btn btn-primary w-100" type="submit">
          Lägg till
        </button>
      </div>
    </form>
  </div>

  <!-- Lista av citat -->
  <div *ngFor="let q of quotes" class="card mb-3 p-3">
    <!-- Visningsläge -->
    <ng-container *ngIf="editingId !== q.id; else editTpl">
      <div class="fw-semibold mb-1">"{{ q.text }}"</div>
      <div class="text-muted small mb-2">
        {{
          q.author && q.author.trim()
            ? q.author
            : '(Okänd författare)'
        }}
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-outline-secondary" (click)="startEdit(q)">
          Redigera
        </button>
        <button class="btn btn-sm btn-outline-danger" (click)="remove(q.id)">
          Ta bort
        </button>
      </div>
    </ng-container>

    <!-- Redigeringsläge -->
    <ng-template #editTpl>
      <div class="mb-2">
        <label class="form-label">Citat</label>
        <textarea
          class="form-control"
          rows="3"
          [(ngModel)]="editCache.text"
          name="editText{{ q.id }}"
        ></textarea>
      </div>
      <div class="mb-2">
        <label class="form-label">Författare (valfritt)</label>
        <input
          class="form-control"
          type="text"
          [(ngModel)]="editCache.author"
          name="editAuthor{{ q.id }}"
        />
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-sm btn-success" (click)="save(q.id)">
          Spara
        </button>
        <button class="btn btn-sm btn-outline-secondary" (click)="cancel()">
          Avbryt
        </button>
      </div>
    </ng-template>
  </div>
</div>
